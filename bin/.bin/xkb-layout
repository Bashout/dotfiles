#!/bin/sh

# Return current X keyboard layout

# NOTE: This script has a couple of limitations.
# - You can only have 2 keyboard layouts configured in your '.xinitrc' file.
#   e.g. setxkbmap -layout 'gb,us' -option 'ctrl:nocaps,grp:win_space_toggle'
# - When pressing media keys on your keyboard, this script may output the wrong
#   value until another key is pressed (excluding media keys).
#
# The only way around these limitations is to replace the script entirely with
# one which can also set the keyboard layout. That script would then be used
# rather than configuring keyboard layouts in your '.xinitrc' file.

# TODO support Wayland or create a variant for Wayland

keymaps="$(setxkbmap -query | grep layout | awk '{print $2}')"

case "$(xset -q | grep LED | awk '{ print $10 }')" in
    "00000000") echo "$keymaps" | tr ',' "\n" | sed -n '1p' ;;
    "00001000") echo "$keymaps" | tr ',' "\n" | sed -n '2p' ;;
    *) echo "unknown" ;;
esac
